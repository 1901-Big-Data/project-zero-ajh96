<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserOracle.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Calculator</a> &gt; <a href="index.source.html" class="el_package">com.revature.dao</a> &gt; <span class="el_source">UserOracle.java</span></div><h1>UserOracle.java</h1><pre class="source lang-java linenums">package com.revature.dao;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Types;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import com.revature.JDBCBank.UserAccounts;
import com.revature.JDBCBank.UserInfo;
import com.revature.util.ConnectionUtil;

public class UserOracle implements UserDao{

	private static UserOracle instance;
<span class="fc" id="L20">	private UserOracle () {}</span>
	public static UserDao getDao() {
<span class="fc bfc" id="L22" title="All 2 branches covered.">		if (instance == null) {</span>
<span class="fc" id="L23">			instance = new UserOracle();</span>
		}
<span class="fc" id="L25">		return instance;</span>
	}
	@Override
	public Optional&lt;List&lt;UserInfo&gt;&gt; getAllUsers() {
<span class="fc" id="L29">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="pc bpc" id="L31" title="1 of 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L32">			return Optional.empty();</span>
		}
		try {
<span class="fc" id="L35">			String sql = &quot;select * from users where moderator = 0 order by username&quot;;</span>
<span class="fc" id="L36">			PreparedStatement ps = connect.prepareStatement(sql);</span>
<span class="fc" id="L37">			ResultSet rs = ps.executeQuery();</span>
<span class="fc" id="L38">			List&lt;UserInfo&gt; allUsers = new ArrayList&lt;UserInfo&gt;();</span>
<span class="fc bfc" id="L39" title="All 2 branches covered.">			while (rs.next()) {</span>
<span class="fc" id="L40">				allUsers.add(new UserInfo(rs.getInt(&quot;login_id&quot;), rs.getString(&quot;username&quot;), </span>
<span class="fc" id="L41">						&quot;**********&quot;, rs.getString(&quot;firstname&quot;), rs.getString(&quot;lastname&quot;), rs.getString(&quot;email&quot;), rs.getInt(&quot;moderator&quot;)));</span>
			}
<span class="fc" id="L43">			return Optional.of(allUsers);</span>
<span class="nc" id="L44">		} catch (Exception e) {</span>
<span class="nc" id="L45">			System.out.println(&quot;Error from within database.&quot;);</span>
<span class="nc" id="L46">			return Optional.empty();</span>
		}
	}

	@Override
	public Optional&lt;UserInfo&gt; deleteUser(Integer id) {
<span class="nc" id="L52">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="nc bnc" id="L54" title="All 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L55">			return Optional.empty();</span>
		}
		try {
<span class="nc" id="L58">			String sql = &quot;delete from accounts where account_owner = (select username from users where login_id = ?)&quot;;</span>
<span class="nc" id="L59">			PreparedStatement ps = connect.prepareStatement(sql);</span>
<span class="nc" id="L60">			ps.setInt(1, id);</span>
<span class="nc" id="L61">			ps.executeQuery();</span>
<span class="nc" id="L62">			String sql2 = &quot;delete from users where login_id = ?&quot;;</span>
<span class="nc" id="L63">			ps = connect.prepareStatement(sql2);</span>
<span class="nc" id="L64">			ps.setInt(1, id);</span>
<span class="nc" id="L65">			ps.executeQuery();</span>
<span class="nc" id="L66">			String commit = &quot;commit&quot;;</span>
<span class="nc" id="L67">			ps = connect.prepareStatement(commit);</span>
<span class="nc" id="L68">			ps.executeQuery();</span>
<span class="nc" id="L69">			System.out.println(&quot;User and all affiliated accounts have been deleted.&quot;);</span>
<span class="nc" id="L70">			return Optional.empty();</span>
<span class="nc" id="L71">		} catch (Exception e) {</span>
<span class="nc" id="L72">			System.out.println(&quot;Error.&quot;);</span>
<span class="nc" id="L73">			return Optional.empty();</span>
		}
	}

	@Override
	public Optional&lt;UserInfo&gt; createNewUser(String username, String password, String firstname, String lastname,
			String email, Integer mod) {
<span class="nc" id="L80">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="nc bnc" id="L82" title="All 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L83">			return Optional.empty();</span>
		}
		try {
<span class="nc" id="L86">			String sql = &quot;call createNewUser(?, ?, ?, ?, ?, ?, ?)&quot;;</span>
<span class="nc" id="L87">			CallableStatement cs = connect.prepareCall(sql);</span>
<span class="nc" id="L88">			cs.setString(1, username);</span>
<span class="nc" id="L89">			cs.setString(2, password);</span>
<span class="nc" id="L90">			cs.setString(3, firstname);</span>
<span class="nc" id="L91">			cs.setString(4, lastname);</span>
<span class="nc" id="L92">			cs.setString(5, email);</span>
<span class="nc" id="L93">			cs.setInt(6, 0);</span>
<span class="nc" id="L94">			cs.registerOutParameter(7, Types.INTEGER);</span>
<span class="nc" id="L95">			cs.execute();</span>
<span class="nc" id="L96">			Integer id = cs.getInt(7);</span>
<span class="nc" id="L97">			UserInfo user = new UserInfo(id, username, &quot;*****&quot;, firstname, lastname, email, 0);</span>
<span class="nc" id="L98">			System.out.println(&quot;Welcome &quot; + username + &quot; to JDBC Online Banking! Be sure to save your login information somewhere secure!&quot;);</span>
<span class="nc" id="L99">			return Optional.of(user);</span>
<span class="nc" id="L100">		} catch (Exception e) {</span>
<span class="nc" id="L101">			System.out.println(&quot;Username already registered. Use the Member login feature to log in.&quot;);</span>
<span class="nc" id="L102">			return Optional.empty();</span>
		}
	}

	@Override
	public Optional&lt;Boolean&gt; logIn(String username, String password, Integer moderator) {
<span class="fc" id="L108">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L111">			return Optional.empty();</span>
		}
		try {
<span class="fc" id="L114">			String sql = &quot;select * from users where username = ? and pass_word = ? and moderator = ?&quot;;</span>
<span class="fc" id="L115">			PreparedStatement ps = connect.prepareStatement(sql);</span>
<span class="fc" id="L116">			ps.setString(1, username);</span>
<span class="fc" id="L117">			ps.setString(2, password);</span>
<span class="fc" id="L118">			ps.setInt(3, moderator);</span>
<span class="fc" id="L119">			ResultSet login = ps.executeQuery();</span>
<span class="fc" id="L120">			List&lt;Integer&gt; foundUser = new ArrayList&lt;Integer&gt;();</span>
<span class="fc bfc" id="L121" title="All 2 branches covered.">			while (login.next()) {</span>
<span class="fc" id="L122">				foundUser.add(new Integer(login.getInt(&quot;moderator&quot;)));</span>
			}
<span class="fc bfc" id="L124" title="All 2 branches covered.">			if (foundUser.isEmpty()) {</span>
<span class="fc" id="L125">				System.out.println(&quot;Incorrect username/password. Returning to main...&quot;);</span>
<span class="fc" id="L126">				return Optional.of(false);</span>
			} else {
<span class="fc" id="L128">				return Optional.of(true);</span>
			}
<span class="nc" id="L130">		} catch (Exception e) {</span>
<span class="nc" id="L131">			System.out.println(&quot;Error.&quot;);</span>
<span class="nc" id="L132">			return Optional.of(false);</span>
		}
	}

	@Override
	public Optional&lt;List&lt;UserAccounts&gt;&gt; getUserAccounts(String username) {
<span class="fc" id="L138">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="pc bpc" id="L140" title="1 of 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L141">			return Optional.empty();</span>
		}
		try {
<span class="fc" id="L144">			String sql = &quot;select * from accounts where account_owner = ? order by account_id&quot;;</span>
<span class="fc" id="L145">			PreparedStatement ps = connect.prepareStatement(sql);</span>
<span class="fc" id="L146">			ps.setString(1, username);</span>
<span class="fc" id="L147">			ResultSet rs = ps.executeQuery();</span>
<span class="fc" id="L148">			List&lt;UserAccounts&gt; allAccounts = new ArrayList&lt;UserAccounts&gt;();</span>
<span class="fc bfc" id="L149" title="All 2 branches covered.">			while (rs.next()) {</span>
<span class="fc" id="L150">				allAccounts.add(new UserAccounts(rs.getInt(&quot;account_id&quot;), rs.getString(&quot;account_name&quot;), </span>
<span class="fc" id="L151">						rs.getDouble(&quot;balance&quot;)));</span>
			}
<span class="fc" id="L153">			return Optional.of(allAccounts);</span>
<span class="nc" id="L154">		} catch (Exception e) {</span>
<span class="nc" id="L155">			System.out.println(&quot;Error from within database.&quot;);</span>
<span class="nc" id="L156">			return Optional.empty();</span>
		}
	}

	@Override
	public Optional&lt;UserAccounts&gt; createNewAccount(String name, String username) {
<span class="nc" id="L162">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="nc bnc" id="L164" title="All 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L165">			return Optional.empty();</span>
		}
		try {
<span class="nc" id="L168">			String sql = &quot;call createNewAccount(?, ?, ?, ?)&quot;;</span>
<span class="nc" id="L169">			CallableStatement cs = connect.prepareCall(sql);</span>
<span class="nc" id="L170">			cs.setString(1, name);</span>
<span class="nc" id="L171">			cs.setString(2, username);</span>
<span class="nc" id="L172">			cs.setInt(3, 0);</span>
<span class="nc" id="L173">			cs.registerOutParameter(4, Types.INTEGER);</span>
<span class="nc" id="L174">			cs.execute();</span>
<span class="nc" id="L175">			Integer id = cs.getInt(4);</span>
<span class="nc" id="L176">			UserAccounts user = new UserAccounts(id, name, 0.0);</span>
<span class="nc" id="L177">			System.out.println(&quot;New account &quot; + name + &quot; has been created!&quot;);</span>
<span class="nc" id="L178">			return Optional.of(user);</span>
<span class="nc" id="L179">		} catch (Exception e) {</span>
<span class="nc" id="L180">			System.out.println(&quot;Could not create new account. Please try again.&quot;);</span>
<span class="nc" id="L181">			return Optional.empty();</span>
		}
	}

	@Override
	public Optional&lt;UserAccounts&gt; deleteAccount(Integer id, String username) {
<span class="nc" id="L187">Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="nc bnc" id="L189" title="All 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L190">			return Optional.empty();</span>
		}
		try {
<span class="nc" id="L193">			String checkFunds = &quot;select balance from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="nc" id="L194">			PreparedStatement ps = connect.prepareStatement(checkFunds);</span>
<span class="nc" id="L195">			ps.setInt(1, id);</span>
<span class="nc" id="L196">			ps.setString(2, username);</span>
<span class="nc" id="L197">			ResultSet rs = ps.executeQuery();</span>
<span class="nc" id="L198">			rs.next();</span>
<span class="nc" id="L199">			Double checkBalance = rs.getDouble(1);</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">			if (checkBalance != 0.0) {</span>
<span class="nc" id="L201">				throw new Exception(&quot;Residual Funds Error&quot;);</span>
			}
<span class="nc" id="L203">			String sql = &quot;delete from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="nc" id="L204">			ps = connect.prepareStatement(sql);</span>
<span class="nc" id="L205">			ps.setInt(1, id);</span>
<span class="nc" id="L206">			ps.setString(2, username);</span>
<span class="nc" id="L207">			ps.executeQuery();</span>
<span class="nc" id="L208">			System.out.println(&quot;Account &quot; + id + &quot; has been successfully closed.&quot;);</span>
<span class="nc" id="L209">			String commit = &quot;commit&quot;;</span>
<span class="nc" id="L210">			ps = connect.prepareStatement(commit);</span>
<span class="nc" id="L211">			ps.executeQuery();</span>
<span class="nc" id="L212">			return Optional.empty();</span>
<span class="nc" id="L213">		} catch (SQLException e) {</span>
<span class="nc" id="L214">			System.out.println(&quot;You do not own the selected account. Access denied.&quot;);</span>
<span class="nc" id="L215">			return Optional.empty();</span>
<span class="nc" id="L216">		} catch (Exception e) {</span>
<span class="nc" id="L217">			System.out.println(&quot;Account still has funds available. Please use the withdraw feature to empty account before closure.&quot;);</span>
<span class="nc" id="L218">			return Optional.empty();</span>
		}
	}

	@Override
	public Optional&lt;UserAccounts&gt; depositAccount(Integer id, Double balance, String username) {
<span class="fc" id="L224">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="pc bpc" id="L226" title="1 of 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L227">			return Optional.empty();</span>
		}
		try {
<span class="fc" id="L230">			String sql = &quot;update accounts set balance = ? + (select balance from accounts where account_id = ?) where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L231">			PreparedStatement ps = connect.prepareStatement(sql);</span>
<span class="fc" id="L232">			ps.setDouble(1, balance);</span>
<span class="fc" id="L233">			ps.setInt(2, id);</span>
<span class="fc" id="L234">			ps.setInt(3, id);</span>
<span class="fc" id="L235">			ps.setString(4, username);</span>
<span class="fc" id="L236">			ps.executeQuery();</span>
<span class="fc" id="L237">			String sql2 = &quot;select balance from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L238">			ps = connect.prepareStatement(sql2);</span>
<span class="fc" id="L239">			ps.setInt(1, id);</span>
<span class="fc" id="L240">			ps.setString(2, username);</span>
<span class="fc" id="L241">			ResultSet rs = ps.executeQuery();</span>
<span class="fc" id="L242">			rs.next();</span>
<span class="fc" id="L243">			Double newBalance = rs.getDouble(1);</span>
<span class="fc" id="L244">			System.out.println(&quot;New account balance: $&quot; + newBalance);</span>
<span class="fc" id="L245">			String commit = &quot;commit&quot;;</span>
<span class="fc" id="L246">			ps = connect.prepareStatement(commit);</span>
<span class="fc" id="L247">			ps.executeQuery();</span>
<span class="fc" id="L248">			return Optional.empty();</span>
<span class="fc" id="L249">		} catch (Exception e) {</span>
<span class="fc" id="L250">			System.out.println(&quot;You do not own the selected account. Access denied.&quot;);</span>
<span class="fc" id="L251">			return Optional.empty();</span>
		}
	}

	@Override
	public Optional&lt;UserAccounts&gt; withdrawAccount(Integer id, Double balance, String username) {
<span class="fc" id="L257">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="pc bpc" id="L259" title="1 of 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L260">			return Optional.empty();</span>
		}
		try {
<span class="fc" id="L263">			String checkFunds = &quot;select balance from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L264">			PreparedStatement ps = connect.prepareStatement(checkFunds);</span>
<span class="fc" id="L265">			ps.setInt(1, id);</span>
<span class="fc" id="L266">			ps.setString(2, username);</span>
<span class="fc" id="L267">			ResultSet rs = ps.executeQuery();</span>
<span class="fc" id="L268">			rs.next();</span>
<span class="fc" id="L269">			Double checkBalance = rs.getDouble(1);</span>
<span class="fc bfc" id="L270" title="All 2 branches covered.">			if (checkBalance &lt; balance) {</span>
<span class="fc" id="L271">				throw new Exception(&quot;Overdraft Error&quot;);</span>
			}
<span class="fc" id="L273">			String sql = &quot;update accounts set balance = -? + (select balance from accounts where account_id = ?) where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L274">			ps = connect.prepareStatement(sql);</span>
<span class="fc" id="L275">			ps.setDouble(1, balance);</span>
<span class="fc" id="L276">			ps.setInt(2, id);</span>
<span class="fc" id="L277">			ps.setInt(3, id);</span>
<span class="fc" id="L278">			ps.setString(4, username);</span>
<span class="fc" id="L279">			ps.executeQuery();</span>
<span class="fc" id="L280">			String sql2 = &quot;select balance from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L281">			ps = connect.prepareStatement(sql2);</span>
<span class="fc" id="L282">			ps.setInt(1, id);</span>
<span class="fc" id="L283">			ps.setString(2, username);</span>
<span class="fc" id="L284">			rs = ps.executeQuery();</span>
<span class="fc" id="L285">			rs.next();</span>
<span class="fc" id="L286">			Double newBalance = rs.getDouble(1);</span>
<span class="fc" id="L287">			System.out.println(&quot;New account balance: $&quot; + newBalance);</span>
<span class="fc" id="L288">			String commit = &quot;commit&quot;;</span>
<span class="fc" id="L289">			ps = connect.prepareStatement(commit);</span>
<span class="fc" id="L290">			ps.executeQuery();</span>
<span class="fc" id="L291">			return Optional.empty();</span>
<span class="fc" id="L292">		} catch (SQLException e) {</span>
<span class="fc" id="L293">			System.out.println(&quot;You do not own the selected account. Access denied.&quot;);</span>
<span class="fc" id="L294">			return Optional.empty();</span>
<span class="fc" id="L295">		} catch (Exception e) {</span>
<span class="fc" id="L296">			System.out.println(&quot;Overdraft Error: Account has insufficient funds.&quot;);</span>
<span class="fc" id="L297">			return Optional.empty();</span>
		}
	}

	@Override
	public Optional&lt;UserAccounts&gt; transferBetweenAccounts(Integer id, Double balance, Integer id2, String username) {
<span class="fc" id="L303">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="pc bpc" id="L305" title="1 of 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L306">			return Optional.empty();</span>
		}
		try {
			//ensure user is not overdrafting from account
<span class="fc" id="L310">			String checkFunds = &quot;select balance from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L311">			PreparedStatement ps = connect.prepareStatement(checkFunds);</span>
<span class="fc" id="L312">			ps.setInt(1, id);</span>
<span class="fc" id="L313">			ps.setString(2, username);</span>
<span class="fc" id="L314">			ResultSet rs = ps.executeQuery();</span>
<span class="fc" id="L315">			rs.next();</span>
<span class="fc" id="L316">			Double checkBalance = rs.getDouble(1);</span>
<span class="fc bfc" id="L317" title="All 2 branches covered.">			if (checkBalance &lt; balance) {</span>
<span class="fc" id="L318">				throw new Exception(&quot;Overdraft Error&quot;);</span>
			}
			
			//check if user owns account id
<span class="fc" id="L322">			String checkOwnership1 = &quot;select balance from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L323">			ps = connect.prepareStatement(checkOwnership1);</span>
<span class="fc" id="L324">			ps.setInt(1, id);</span>
<span class="fc" id="L325">			ps.setString(2, username);</span>
<span class="fc" id="L326">			rs = ps.executeQuery();</span>
<span class="fc" id="L327">			rs.next();</span>
<span class="fc" id="L328">			Double Ownership1 = rs.getDouble(1);</span>
			
			//check if user owns account id2
<span class="fc" id="L331">			String checkOwnership2 = &quot;select balance from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L332">			ps = connect.prepareStatement(checkOwnership2);</span>
<span class="fc" id="L333">			ps.setInt(1, id2);</span>
<span class="fc" id="L334">			ps.setString(2, username);</span>
<span class="fc" id="L335">			rs = ps.executeQuery();</span>
<span class="fc" id="L336">			rs.next();</span>
<span class="fc" id="L337">			Double Ownership2 = rs.getDouble(1);</span>
			
			//if passes all checks, actually modify account values
<span class="fc" id="L340">			String sql = &quot;update accounts set balance = -? + (select balance from accounts where account_id = ?) where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L341">			ps = connect.prepareStatement(sql);</span>
<span class="fc" id="L342">			ps.setDouble(1, balance);</span>
<span class="fc" id="L343">			ps.setInt(2, id);</span>
<span class="fc" id="L344">			ps.setInt(3, id);</span>
<span class="fc" id="L345">			ps.setString(4, username);</span>
<span class="fc" id="L346">			ps.executeQuery();</span>
<span class="fc" id="L347">			String sql2 = &quot;select balance from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L348">			ps = connect.prepareStatement(sql2);</span>
<span class="fc" id="L349">			ps.setInt(1, id);</span>
<span class="fc" id="L350">			ps.setString(2, username);</span>
<span class="fc" id="L351">			rs = ps.executeQuery();</span>
<span class="fc" id="L352">			rs.next();</span>
<span class="fc" id="L353">			Double newBalance1 = rs.getDouble(1);</span>
<span class="fc" id="L354">			System.out.println(&quot;New balance of account_id &quot; + id + &quot;: $&quot; + newBalance1);</span>
<span class="fc" id="L355">			String sql3 = &quot;update accounts set balance = ? + (select balance from accounts where account_id = ?) where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L356">			ps = connect.prepareStatement(sql3);</span>
<span class="fc" id="L357">			ps.setDouble(1, balance);</span>
<span class="fc" id="L358">			ps.setInt(2, id2);</span>
<span class="fc" id="L359">			ps.setInt(3, id2);</span>
<span class="fc" id="L360">			ps.setString(4, username);</span>
<span class="fc" id="L361">			ps.executeQuery();</span>
<span class="fc" id="L362">			String sql4 = &quot;select balance from accounts where account_id = ? and account_owner = ?&quot;;</span>
<span class="fc" id="L363">			ps = connect.prepareStatement(sql4);</span>
<span class="fc" id="L364">			ps.setInt(1, id2);</span>
<span class="fc" id="L365">			ps.setString(2, username);</span>
<span class="fc" id="L366">			rs = ps.executeQuery();</span>
<span class="fc" id="L367">			rs.next();</span>
<span class="fc" id="L368">			Double newBalance2 = rs.getDouble(1);</span>
<span class="fc" id="L369">			System.out.println(&quot;New balance of account_id &quot; + id2 + &quot;: $&quot; + newBalance2);</span>
<span class="fc" id="L370">			String commit = &quot;commit&quot;;</span>
<span class="fc" id="L371">			ps = connect.prepareStatement(commit);</span>
<span class="fc" id="L372">			ps.executeQuery();</span>
<span class="fc" id="L373">			return Optional.empty();</span>
<span class="fc" id="L374">		} catch (SQLException e) {</span>
<span class="fc" id="L375">			System.out.println(&quot;You do not own selected account(s). Access denied.&quot;);</span>
<span class="fc" id="L376">			return Optional.empty();</span>
<span class="fc" id="L377">		} catch (Exception e) {</span>
<span class="fc" id="L378">			System.out.println(&quot;Overdraft Error: Account &quot; + id + &quot; has insufficient funds.&quot;);</span>
<span class="fc" id="L379">			return Optional.empty();</span>
		}
	}
	@Override
	public Optional&lt;UserInfo&gt; modifyUser(Integer id, String firstname, String lastname, String email) {
<span class="nc" id="L384">		Connection connect = ConnectionUtil.getConnection();</span>
		
<span class="nc bnc" id="L386" title="All 2 branches missed.">		if (connect == null) {</span>
<span class="nc" id="L387">			return Optional.empty();</span>
		}
		try {
<span class="nc" id="L390">			String sql = &quot;update users set firstname = ?, lastname = ?, email = ? where login_id = ?&quot;;</span>
<span class="nc" id="L391">			PreparedStatement ps = connect.prepareStatement(sql);</span>
<span class="nc" id="L392">			ps.setString(1, firstname);</span>
<span class="nc" id="L393">			ps.setString(2, lastname);</span>
<span class="nc" id="L394">			ps.setString(3, email);</span>
<span class="nc" id="L395">			ps.setInt(4, id);</span>
<span class="nc" id="L396">			ps.executeQuery();</span>
<span class="nc" id="L397">			System.out.println(&quot;Account id# &quot; + id + &quot; updated to: \n&quot;</span>
<span class="nc" id="L398">					+ &quot;First name: &quot; + firstname + &quot; \n&quot;</span>
<span class="nc" id="L399">					+ &quot;Last name: &quot; + lastname + &quot; \n&quot;</span>
<span class="nc" id="L400">					+ &quot;Email address: &quot; + email);</span>
<span class="nc" id="L401">			return Optional.empty();</span>
<span class="nc" id="L402">		} catch (Exception e) {</span>
<span class="nc" id="L403">			System.out.println(&quot;Error.&quot;);</span>
<span class="nc" id="L404">			return Optional.empty();</span>
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>